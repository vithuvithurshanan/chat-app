<div style="background: linear-gradient(270deg, #1e3c72, #2a5298, #4a00e0); min-height: 100vh; display: flex; flex-direction: column;">
<header style="
  background: linear-gradient(270deg, #1e3c72, #2a5298, #4a00e0);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem;
  position: sticky;
  top: 0;
  z-index: 10;
  height: 3rem;
  flex-shrink: 0;
">
  <!-- Logo -->
  <div style="
    background: linear-gradient(270deg, #1e3c72, #2a5298, #4a00e0);
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid #d1d5db;
  ">
    <img
      src="https://img.freepik.com/premium-vector/fierce-wolf-w-logo-design-dynamic-bold-branding-emblem_396380-134.jpg?w=740"
      alt="Wolf Logo"
      style="width: 100%; height: 100%; object-fit: cover;"
    >
  </div>

  <!-- Title -->
  <h1 style="color:white; font-weight:bold; font-size:1.25rem; margin:0;">
    Wolf Chat
  </h1>

  <!-- Logout -->
  <button style="margin-left:auto; padding:0.5rem 1rem; background:rgba(255,255,255,0.15);
                 border:1px solid rgba(255,255,255,0.3); border-radius:0.5rem; color:white;
                 font-weight:bold; cursor:pointer;"
          (click)="logout()">
    Logout
  </button>
</header>

<!-- Main Container with Sidebar Layout -->
<div style="display: flex; flex: 1; position: relative; overflow: hidden;">

  <!-- Left Sidebar - Users List (Always Visible) -->
  <div class="users-sidebar">
    <div style="padding: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
      <h3 style="color: white; margin: 0 0 1rem 0; font-size: 1.2rem;">Chats</h3>

      <!-- Search Box -->
      <input
        type="text"
        placeholder="Search or start new chat"
        style="
          width: 100%;
          padding: 0.5rem;
          border-radius: 0.5rem;
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.2);
          color: white;
          outline: none;
        "
      />
    </div>

    <!-- Users List -->
    <div style="overflow-y: auto; height: calc(100% - 100px);">

      <!-- Recent Chats Section -->
      <div *ngIf="recentChats.length > 0">
        <div
          *ngFor="let u of recentChats"
          (click)="selectUser(u)"
          [class.selected-user]="u.uid === selectedUserId"
          class="user-list-item"
        >
          <!-- User Avatar -->
          <div class="user-list-avatar">
            {{ getInitials(u.displayName || u.email) }}

            <!-- Online/Offline Indicator -->
            <div
              [style.background]="u.online ? '#00ff00' : '#ff0000'"
              class="status-dot"
            ></div>
          </div>

          <!-- User Info -->
          <div style="flex: 1; min-width: 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
              <span style="color: white; font-weight: 500; font-size: 0.95rem;">
                {{ u.displayName || u.email }}
              </span>
              <span style="color: rgba(255, 255, 255, 0.5); font-size: 0.75rem;">
                {{ u.lastMessageTime ? (u.lastMessageTime | date:'shortTime') : '' }}
              </span>
            </div>

            <!-- Last Message Preview -->
            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
              {{ u.online ? 'Online' : 'Offline' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Contacts Section -->
      <div *ngIf="allContacts.length > 0">
        <!-- Contacts Header -->
        <div style="
          padding: 0.75rem 1rem;
          background: rgba(255, 255, 255, 0.05);
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          margin-top: 0.5rem;
        ">
          <h4 style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
            Contacts
          </h4>
        </div>

        <!-- Contacts List -->
        <div
          *ngFor="let u of allContacts"
          (click)="selectUser(u)"
          [class.selected-user]="u.uid === selectedUserId"
          class="user-list-item"
        >
          <!-- User Avatar -->
          <div class="user-list-avatar">
            {{ getInitials(u.displayName || u.email) }}

            <!-- Online/Offline Indicator -->
            <div
              [style.background]="u.online ? '#00ff00' : '#ff0000'"
              class="status-dot"
            ></div>
          </div>

          <!-- User Info -->
          <div style="flex: 1; min-width: 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
              <span style="color: white; font-weight: 500; font-size: 0.95rem;">
                {{ u.displayName || u.email }}
              </span>
            </div>

            <!-- Status -->
            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
              {{ u.online ? 'Online' : 'Offline' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="recentChats.length === 0 && allContacts.length === 0" style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.5);">
        No users available
      </div>
    </div>
  </div>

  <!-- User Details Panel (Toggleable) -->
  <div *ngIf="showUserDetails" class="user-details-sidebar">

    <!-- Close Button -->
    <button (click)="closeUserDetails()"
            style="
              position: absolute;
              top: 1rem;
              right: 1rem;
              background: none;
              border: none;
              color: white;
              font-size: 1.5rem;
              cursor: pointer;
            ">
      âœ•
    </button>

    <!-- User Profile Section -->
    <div *ngIf="selectedUserDetails" style="text-align: center; margin-bottom: 2rem;">
      <!-- Profile Picture -->
      <div class="user-avatar">
        {{ getInitials(selectedUserDetails.displayName || selectedUserDetails.email) }}
      </div>

      <!-- User Name -->
      <h2 style="color: white; margin: 0 0 0.5rem 0; font-size: 1.5rem;">
        {{ selectedUserDetails.displayName || 'User' }}
      </h2>

      <!-- Email -->
      <p style="color: rgba(255, 255, 255, 0.7); margin: 0 0 1rem 0;">
        {{ selectedUserDetails.email }}
      </p>

      <!-- Online Status -->
      <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
        <div [style.background]="selectedUserDetails.online ? 'limegreen' : 'red'"
             style="width: 12px; height: 12px; border-radius: 50%;"></div>
        <span style="color: white; font-size: 0.9rem;">
          {{ selectedUserDetails.online ? 'Online' : 'Offline' }}
        </span>
      </div>
    </div>

    <!-- User Info Sections -->
    <div *ngIf="selectedUserDetails" style="space-y: 1rem;">

      <!-- About Section -->
      <div class="user-info-section">
        <h3 style="color: white; margin: 0 0 0.5rem 0; font-size: 1rem;">About</h3>
        <p style="color: rgba(255, 255, 255, 0.8); margin: 0; font-size: 0.9rem;">
          {{ selectedUserDetails.about || 'Hey there! I am using Wolf Chat.' }}
        </p>
      </div>

      <!-- Contact Info -->
      <div class="user-info-section">
        <h3 style="color: white; margin: 0 0 1rem 0; font-size: 1rem;">Contact Info</h3>

        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
          <div style="
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
          ">
            ğŸ“§
          </div>
          <div>
            <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.8rem;">Email</p>
            <p style="color: white; margin: 0; font-size: 0.9rem;">{{ selectedUserDetails.email }}</p>
          </div>
        </div>

        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <div style="
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
          ">
            ğŸ“±
          </div>
          <div>
            <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.8rem;">Phone</p>
            <p style="color: white; margin: 0; font-size: 0.9rem;">{{ selectedUserDetails.phone || 'Not provided' }}</p>
          </div>
        </div>
      </div>

      <!-- Media Section -->
      <div class="user-info-section">
        <h3 style="color: white; margin: 0 0 0.5rem 0; font-size: 1rem;">Media, Links and Docs</h3>
        <p style="color: rgba(255, 255, 255, 0.6); margin: 0; font-size: 0.8rem; text-align: center; padding: 1rem;">
          No media shared yet
        </p>
      </div>

      <!-- Action Buttons -->
      <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1.5rem;">
        <button class="action-button">
          ğŸ”‡ Mute notifications
        </button>

        <button class="action-button">
          ğŸ—‚ï¸ Custom wallpaper
        </button>

        <button class="action-button danger">
          ğŸš« Block user
        </button>
      </div>
    </div>
  </div>

  <!-- Chat Area -->
  <div style="flex: 1; display: flex; flex-direction: column;">

    <!-- Chat Header with Selected User -->
    <div *ngIf="selectedUserName" class="chat-header">
      <!-- User Avatar (clickable) -->
      <div class="chat-avatar" (click)="showUserDetailsPanel(selectedUserForDetails)">
        {{ getInitials(selectedUserName) }}
      </div>

      <div style="flex: 1;">
        <h2 style="color:white; margin:0; font-size: 1.2rem;">
          {{ selectedUserName }}
        </h2>
        <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.9rem;">
          {{ selectedUserForDetails?.online ? 'Online' : 'Last seen recently' }}
        </p>
      </div>

      <!-- Chat Actions -->
      <div style="display: flex; gap: 0.5rem;">
        <button class="chat-action-btn">
          ğŸ“
        </button>
        <button class="chat-action-btn">
          ğŸ“¹
        </button>
        <button (click)="showUserDetailsPanel(selectedUserForDetails)" class="chat-action-btn">
          â„¹ï¸
        </button>
      </div>
    </div>

    <!-- Main Chat -->
    <main style="
      flex: 1;
      margin: 1rem;
      margin-bottom: 0;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    ">

      <!-- Messages -->
      <div style="
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background: rgba(0,0,0,0.25);
        border-radius: 1rem;
        margin-bottom: 1rem;
        min-height: 300px;
      ">
    <div *ngFor="let m of messages$ | async"
         [style.textAlign]="m.uid === currentUser ? 'right' : 'left'"
         style="margin-bottom: 1rem;">
      <div style="display:inline-block; padding:0.75rem 1rem; border-radius:0.75rem;
                  background: rgba(255,255,255,0.08); color:white; max-width:70%;">
        <b *ngIf="m.uid !== currentUser">{{ m.displayName || m.uid }}: </b>
        {{ m.text }}
        <div style="font-size:0.75rem; color:#ddd; margin-top:0.25rem;">
          {{ m.createdAt?.toDate() | date:'short' }}
        </div>
      </div>
      <button *ngIf="m.uid === currentUser"
              (click)="delete(m)"
              style="margin-left:5px; background:none; border:none; color:#f87171; cursor:pointer;">
        ğŸ—‘
      </button>
    </div>

        <div *ngIf="(messages$ | async)?.length === 0"
             style="text-align:center; padding:2rem; color:#d1d5db;">
          No messages yet. Start the conversation!
        </div>
      </div>

      <!-- Input -->
      <form [formGroup]="form" (ngSubmit)="send()" style="display:flex; gap:0.75rem;">
        <input formControlName="text" placeholder="Write a message..."
               style="flex:1; padding:0.75rem 1rem; border-radius:0.75rem;
                      background:rgba(55,65,81,0.4);
                      border:1px solid rgba(55,65,81,0.7);
                      color:white; outline:none; font-size:1rem;"
               (keydown)="onKeyDown($event)">
        <button type="submit" [disabled]="form.invalid"
                style="padding:0.75rem 1.5rem; background:rgba(255,255,255,0.15);
                       border:1px solid rgba(255,255,255,0.2);
                       border-radius:0.75rem; color:white; font-weight:600; cursor:pointer;">
          Send
        </button>
      </form>
      <div style="margin-top:0.5rem; font-size:0.75rem; color:#9ca3af; text-align:right;">
        {{ form.get('text')?.value?.length || 0 }}/500
      </div>
    </main>
  </div>
</div>
  <footer style="
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-top: 1px solid rgba(255, 255, 255, 0.2);
  padding: 1rem;
  text-align: center;
  color: white;
  font-size: 0.75rem;
  line-height: 1.25rem;
  flex-shrink: 0;
">
    <p>Â© 2023 Wolf Chat. All rights reserved. | <a href="#" style="color: rgba(252, 165, 165, 1);">Privacy Policy</a> | <a href="#" style="color: rgba(252, 165, 165, 1);">Terms of Service</a></p>
  </footer>
</div>
